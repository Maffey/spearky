#:kivy 1.11.1

#: import threading threading

#:import mac_changer core.penetration.mac_changer


#:set standard_padding 20
#:set standard_menu_padding 40
#:set standard_text_height 30
#:set standard_spacing 10


# Root widget of the app.
WindowManager:
    MainMenuScreen:

    DetectionToolsScreen:
    SniffPacketsScreen:

    EscalationToolsScreen:

    PenetrationToolsScreen:
    ChangeMACScreen:
    SpoofARPScreen:


# Widget classes.
<MenuButton@Button>:
    pos_hint: {"center_x": 0.5}
    size_hint_x: 0.5

<NavigationButton@Button>:
    size_hint: 0.2, 0.2

<BackToMenuButton@NavigationButton>:
    text: "Back"
    pos_hint: {"center_x": 0.2, "top": 0.3}

<StartActionButton@NavigationButton>:
    pos_hint: {"center_x": 0.8, "y": 0.4}

<StopActionButton@NavigationButton>:
    pos_hint: {"center_x": 0.8, "top": 0.3}

<FeedbackPopup@Popup>:
    feedback_text: feedback_content_label
    title: "Feedback Popup"

    FloatLayout:

        Label:
            id: feedback_content_label
            text: "Action performed successfully."
            size_hint: 0.6, None
            pos_hint: {"center_x": 0.5, "top": 0.9}
            text_size: self.width, None
            height: self.texture_size[1]
            halign: "center"

        Button:
            text: "Close"
            size_hint: 0.6, 0.2
            pos_hint: {"center_x": 0.5, "y": 0.1}
            on_press: root.dismiss()

<BackgroundColor@Widget>
    background_color: 1, 1, 1, 1
    canvas.before:
        Color:
            rgba: root.background_color
        Rectangle:
            size: self.size
            pos: self.pos

<BackgroundLabel@Label+BackgroundColor>
    background_color: 0, 0, 0, 0

# Main elements of UI.

<MainMenuScreen>:
    name: "main_menu_screen"

    BoxLayout:
        orientation: "vertical"
        spacing: root.height / 6
        padding: standard_menu_padding

        Label:
            text: "Spearky"
            font_size: 48

        MenuButton:
            text: "Detection Tools"
            on_release:
                app.root.current = "detection_tools_screen"
                root.manager.transition.direction = "left"

        MenuButton:
            text: "Escalation Tools"

        MenuButton:
            text: "Penetration Tools"
            on_release:
                app.root.current = "penetration_tools_screen"
                root.manager.transition.direction = "left"


<DetectionToolsScreen>:
    name: "detection_tools_screen"

    BoxLayout:
        orientation: "vertical"
        spacing: root.height / 4
        padding: standard_menu_padding

        MenuButton:
            text: "Sniff Packets"
            on_release:
                app.root.current = "sniff_packets_screen"
                root.manager.transition.direction = "left"

        MenuButton:
            text: "Back"
            on_release:
                app.root.current = "main_menu_screen"
                root.manager.transition.direction = "right"


<SniffPacketsScreen>:
    name: "sniff_packets_screen"
    interface_input: interface_sniff_text_input
    terminal_output: terminal_output_text_input
    found_credentials: found_credentials_text_input

    BoxLayout:
        orientation: "vertical"
        padding: standard_padding
        spacing: standard_spacing

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: 0.1

            Label:
                text: "Interface:"
                size_hint_y: None
                height: standard_text_height
                bold: True

            TextInput:
                id: interface_sniff_text_input
                hint_text: "eth0"
                size_hint_y: None
                height: standard_text_height
                multiline: False


        GridLayout:
            cols: 2
            spacing: standard_spacing

            Label:
                text: "Terminal output:"
                size_hint_y: None
                height: standard_text_height

            Label:
                text: "Found credentials:"
                size_hint_y: None
                height: standard_text_height
                size_hint_x: 0.6

            TextInput:
                id: terminal_output_text_input
                font_size: 10


            TextInput:
                id: found_credentials_text_input
                size_hint_x: 0.6
                font_size: 10


        FloatLayout:
            size_hint_y: 0.5

            StartActionButton:
                text: "Sniff"
                on_release: threading.Thread(target=root.start_sniffing).start()

            StopActionButton:
                text: "Stop"
                on_release: root.stop_sniffing()

            BackToMenuButton:
                on_release:
                    app.root.current = "detection_tools_screen"
                    root.manager.transition.direction = "right"


<EscalationToolsScreen>:


<PenetrationToolsScreen>:
    name: "penetration_tools_screen"

    BoxLayout:
        orientation: "vertical"
        spacing: root.height / 4
        padding: standard_menu_padding

        MenuButton:
            text: "Change MAC Address"
            on_release:
                app.root.current = "change_mac_screen"
                root.manager.transition.direction = "left"

        MenuButton:
            text: "Spoof ARP Table"
            on_release:
                app.root.current = "spoof_arp_screen"
                root.manager.transition.direction = "left"

        MenuButton:
            text: "Back"
            on_release:
                app.root.current = "main_menu_screen"
                root.manager.transition.direction = "right"


<ChangeMACScreen>:
    name: "change_mac_screen"
    original_mac: original_mac_label
    current_mac: current_mac_label
    interface_input: interface_text_input
    mac_input: mac_text_input

    BoxLayout:
        orientation: "vertical"

        GridLayout:
            cols: 2
            padding: standard_padding
            spacing: standard_spacing

            Label:
                text: "Original MAC address:"
                size_hint_y: None
                height: standard_text_height
                bold: True

            Label:
                id: original_mac_label
                text: mac_changer.get_original_mac()
                size_hint_y: None
                height: standard_text_height

            Label:
                text: "Current MAC address:"
                size_hint_y: None
                height: standard_text_height
                bold: True

            Label:
                id: current_mac_label
                text: mac_changer.get_current_mac()
                size_hint_y: None
                height: standard_text_height

            Label:
                text: "Interface:"
                size_hint_y: None
                height: standard_text_height
                bold: True

            TextInput:
                id: interface_text_input
                hint_text: "eth0"
                size_hint_y: None
                height: standard_text_height
                multiline: False

            Label:
                text: "MAC address:"
                size_hint_y: None
                height: standard_text_height
                bold: True

            TextInput:
                id: mac_text_input
                hint_text: "00:aa:bb:cc:33:ff"
                size_hint_y: None
                height: standard_text_height
                multiline: False

        FloatLayout:

            StartActionButton:
                text: "Submit"
                on_release: root.submit_mac()

            StopActionButton:
                text: "Revert"
                on_release: root.revert_mac()

            BackToMenuButton:
                on_release:
                    app.root.current = "penetration_tools_screen"
                    root.manager.transition.direction = "right"


<SpoofARPScreen>:
    name: "spoof_arp_screen"
    target_input: target_text_input
    gateway_input: gateway_text_input
    status: status_label

    BoxLayout:
        orientation: "vertical"

        GridLayout:
            cols: 2
            padding: standard_padding
            spacing: standard_spacing

            Label:
                text: "Target device IP:"
                size_hint_y: None
                height: standard_text_height
                bold: True

            TextInput:
                id: target_text_input
                hint_text: "192.168.0.x"
                size_hint_y: None
                height: standard_text_height
                multiline: False

            Label:
                text: "Gateway IP:"
                size_hint_y: None
                height: standard_text_height
                bold: True

            TextInput:
                id: gateway_text_input
                hint_text: "192.168.0.1"
                size_hint_y: None
                height: standard_text_height
                multiline: False

        FloatLayout:

            StartActionButton:
                text: "Spoof"
                on_release: root.start_spoofing()

            StopActionButton:
                text: "Stop"
                on_release: root.stop_spoofing()

            BoxLayout:
                orientation: "horizontal"
                size_hint: 0.2, 0.2
                pos_hint: {"center_x": 0.2, "y": 0.4}
                padding: standard_padding / 2

                Label:
                    text: "Status:"
                    bold: True

                BackgroundLabel:
                    id: status_label
                    text: "off"
                    background_color: 0, 0, 0, 0  # black
                    color: 1, 1, 1, 1  # white

            BackToMenuButton:
                on_release:
                    app.root.current = "penetration_tools_screen"
                    root.manager.transition.direction = "right"
